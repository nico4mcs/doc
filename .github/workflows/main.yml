name: MakePdf

on:
  push:
  release:
    types: [published]

env:
  GITHUB_TOKEN: ${{ github.token }}

jobs:
  markdown:
    runs-on: windows-latest
    name: Generate Document
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Generate md Doc
        shell: pwsh
        run: |
          mkdir -p ${{ github.workspace }}/artifact
          mkdir -p ${{ github.workspace }}/artifact/media/
          .\generateMarkdown.ps1 > ${{ github.workspace }}/artifact/doc.md
          mv .\bin\media\* ${{ github.workspace }}/artifact/media
      - uses: actions/upload-artifact@v3
        with:
          name: mdFile
          path: ${{ github.workspace }}/artifact/
  pdf:
    runs-on: ubuntu-latest
    name: Publish PDF
    needs: markdown
    steps:
      - name: create Folder
        run: |
          mkdir ${{ github.workspace }}/bin
          mkdir ${{ github.workspace }}/out
      - name: Download artifact
        uses: actions/download-artifact@v3
        with:
          path: ./bin/
          name: mdFile
      - name: create Folder
        run: |
          ls ./bin/
          pwd
      - name: Markdown to PDF and HTML
        # You may pin to the exact commit or the version.
        # uses: BaileyJM02/markdown-to-pdf@1be26775add5f94fb55d4a2ce36ff7cad23b8dd0
        uses: BaileyJM02/markdown-to-pdf@v1
        with:
          # (Path) or (File) The location of the folder containing your .md or .markdown files, or a path to a single .md or .markdown file that you would like to convert.
          input_path: ./bin/doc.md # optional
          # (Path) The location of the folder containing your .md or .markdown files
          # input_dir: # optional
          # (Path) The location of the folder containing your images, this should be the route of all images
          images_dir: ./bin/media # optional
          # (String) The path you use to import your images that can be replaced with the server URL
          # image_import: # optional
          # (Path) The location of the folder you want to place the built files
          output_dir: ./out # optional
          # (Boolean) Whether to also create a .html file
          build_html: false # optional
          # (Boolean) Whether to create a .pdf file (the intended behaviour)
          build_pdf: true # optional
          # (File) The location of the CSS file you want to use as the theme
          # theme: # optional
          # (Boolean) Whether to extend your custom CSS file with the default theme
          # extend_default_theme: # optional
          # (File) The location of the CSS file you want to use as the code snipped highlight theme
          # highlight_theme: # optional
          # (File) The location of the HTML/Mustache file you want to use as the HTML template
          # template: # optional
          # (Boolean) Whether a table of contents should be generated
          table_of_contents: true # optional
      - name: Upload Document
        uses: actions/upload-artifact@v2
        id: upload-document
        with:
          name: 'document.pdf'
          path: ./out/doc.pdf
